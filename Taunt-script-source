-- ... (wcześniejsza część setupu pozostaje bez zmian)

-- LOGIKA ADRENALINY
adrenalineBtn.MouseButton1Click:Connect(function()
	-- Blokada: jeśli jakakolwiek zdolność jest aktywna (animacja lub boosty), nie pozwól na start
	if isUsingAbility or onCooldownAdrenaline or isTaunting or isAdrenaline or (humanoid and humanoid.WalkSpeed ~= 16) then return end
	
	isUsingAbility, isAdrenaline, onCooldownAdrenaline, startTime = true, true, true, tick()
	adrStartSnd:Play()
	
	adrenalineBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	TweenService:Create(adrenalineBtn, TweenInfo.new(adrenalineCooldownTime, Enum.EasingStyle.Linear), {BackgroundColor3 = Color3.fromRGB(80, 80, 80)}):Play()

	if torso:FindFirstChild("Right Shoulder") then torso["Right Shoulder"]:Destroy() end
	if torso:FindFirstChild("Left Shoulder") then torso["Left Shoulder"]:Destroy() end

	humanoid.WalkSpeed = 32
	local oldFOV = camera.FieldOfView
	TweenService:Create(camera, TweenInfo.new(0.5), {FieldOfView = oldFOV * 1.35}):Play()
	
	task.delay(2, function() 
		isAdrenaline = false
		restoreJoints()
		-- isUsingAbility zostanie wyłączone dopiero po skończeniu całego efektu (stun)
	end)

	task.delay(7, function()
		humanoid.WalkSpeed = 0
		adrEndSnd:Play()
		TweenService:Create(camera, TweenInfo.new(1), {FieldOfView = oldFOV}):Play()
		task.wait(3)
		humanoid.WalkSpeed = 16
		isUsingAbility = false -- Teraz można użyć kolejnej zdolności
		task.delay(adrenalineCooldownTime - 10, function() onCooldownAdrenaline = false end)
	end)
end)

-- LOGIKA TAUNTA
tauntBtn.MouseButton1Click:Connect(function()
	-- Blokada: nie pozwól użyć, jeśli adrenalina lub inny taunt trwa
	if isUsingAbility or onCooldownTaunt or isAdrenaline or isTaunting or (humanoid and humanoid.WalkSpeed ~= 16) then return end
	
	isUsingAbility, isTaunting, onCooldownTaunt, startTime = true, true, true, tick()
	tauntSound:Play()
	humanoid.WalkSpeed = 0
	
	tauntBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	TweenService:Create(tauntBtn, TweenInfo.new(7, Enum.EasingStyle.Linear), {BackgroundColor3 = Color3.fromRGB(80, 80, 80)}):Play()

	for _, n in pairs({"Right Shoulder", "Left Shoulder", "Right Hip", "Left Hip"}) do
		if torso:FindFirstChild(n) then torso[n]:Destroy() end
	end

	task.spawn(function()
		local hitDetected = false
		local radii = {3, 6, 9}

		-- 3 Fazy co 0.7 sekundy
		for i = 1, 3 do
			task.wait(0.7)
			if not isTaunting then break end
			for _, other in pairs(Players:GetPlayers()) do
				if other ~= player and other.Character and other.Character:FindFirstChild("Torso") then
					if (torso.Position - other.Character.Torso.Position).Magnitude <= radii[i] then
						hitDetected = true; break
					end
				end
			end
			if hitDetected then break end
		end

		if hitDetected then
			isTaunting = false; tauntSound:Stop(); restoreJoints()
			hitSound.PlaybackSpeed = math.min(1 + (hitStreak * 0.1), 1.5); hitSound:Play()
			hitStreak = hitStreak + 1
			humanoid.WalkSpeed = 24
			local oldFOV = camera.FieldOfView
			TweenService:Create(camera, TweenInfo.new(0.5), {FieldOfView = oldFOV * 1.25}):Play()
			
			task.wait(5) -- Trwanie speed boosta
			humanoid.WalkSpeed = 16
			TweenService:Create(camera, TweenInfo.new(1.5), {FieldOfView = oldFOV}):Play()
			isUsingAbility = false
		else
			-- PUDŁO: Czekamy 1 sekundę po ostatniej fazie (tak jak w opisie)
			task.wait(1)
			if isTaunting then
				hitStreak = 0
				failSound:Play()
				isTaunting = false
				restoreJoints()
				humanoid.WalkSpeed = 16
				isUsingAbility = false
			end
		end
		
		task.delay(7, function() onCooldownTaunt = false end)
	end)
end)
